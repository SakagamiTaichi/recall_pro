# ユビキタス言語定義書 (Ubiquitous Language)

RecallPro プロジェクトにおける共通用語の定義

---

## 1. コアドメイン (Core Domain)

### 1.1 エンティティ (Entities)

| 用語 (日本語) | 用語 (English) | 定義 |
|--------------|----------------|------|
| カード | Card | 学習用のフラッシュカード。表面（日本語）と裏面（英語）を持つ学習単位 |
| カードセット | CardSet | 関連するカードをまとめた集合。デッキとも呼ばれる学習単位の集まり |
| ユーザー | User | アプリの利用者。現在は匿名認証による識別 |

### 1.2 値オブジェクト (Value Objects)

| 用語 (日本語) | 用語 (English) | 定義 |
|--------------|----------------|------|
| 表面 | Front | カードの質問側。日本語で記述される |
| 裏面 | Back | カードの解答側。英語で記述される |
| タイトル | Title | カードセットの名前 |
| 説明 | Description | カードセットの詳細な説明（任意） |
| 並び順 | Order | カードセット内でのカードの表示順序（0始まり） |
| カード枚数 | CardCount | カードセットに含まれるカードの総数 |

---

## 2. 操作・アクション (Operations & Actions)

### 2.1 カードセット操作

| 用語 (日本語) | 用語 (English) | 定義 |
|--------------|----------------|------|
| 新規作成 | Create CardSet | 新しいカードセットを作成する |
| 編集 | Update CardSet | カードセットのタイトルや説明を変更する |
| 削除 | Delete CardSet | カードセットと配下のすべてのカードを削除する（カスケード削除） |
| 検索 | Search | タイトルや説明でカードセットをフィルタリングする |

### 2.2 カード操作

| 用語 (日本語) | 用語 (English) | 定義 |
|--------------|----------------|------|
| カード追加 | Create Card | カードセットに新しいカードを追加する |
| カード編集 | Update Card | カードの表面・裏面を変更する |
| カード削除 | Delete Card | カードをカードセットから削除する |
| 並び替え | Reorder Cards | ドラッグ&ドロップでカードの順序を変更する |
| 連続作成モード | Continuous Creation Mode | ダイアログを閉じずに連続してカードを作成できるモード |

### 2.3 認証操作

| 用語 (日本語) | 用語 (English) | 定義 |
|--------------|----------------|------|
| 匿名ログイン | Sign In Anonymously | ユーザー登録なしでアプリを利用開始する |
| 自動ログイン | Auto Sign-In | アプリ起動時に自動的に認証状態を復元する |
| ログアウト | Sign Out | 認証状態を解除する |

---

## 3. UI/画面 (UI/Screens)

### 3.1 画面

| 用語 (日本語) | 用語 (English) | 定義 |
|--------------|----------------|------|
| カードセット一覧画面 | CardSetListView | すべてのカードセットを表示するメイン画面 |
| カード一覧画面 | CardListView | 選択したカードセット内のすべてのカードを表示する画面 |
| ローディング画面 | Loading Screen | 処理中に表示される読み込み画面 |
| エラー画面 | Error Screen | エラー発生時に表示される画面 |
| 空の状態 | Empty State | データがない場合に表示される状態 |

### 3.2 コンポーネント

| 用語 (日本語) | 用語 (English) | 定義 |
|--------------|----------------|------|
| カードセットタイル | CardSetTile | カードセット一覧の1行分を表示するコンポーネント |
| カードタイル | CardTile | カード一覧の1行分を表示するコンポーネント |
| インフォチップ | InfoChip | カード枚数や更新日時などの情報を表示するバッジ |
| 検索バー | Search Bar | テキスト検索を行うための入力フィールド |

### 3.3 ダイアログ

| 用語 (日本語) | 用語 (English) | 定義 |
|--------------|----------------|------|
| カードセットダイアログ | CardSetDialog | カードセットの作成・編集を行うダイアログ |
| カードダイアログ | CardDialog | カードの作成・編集を行うダイアログ |
| 確認ダイアログ | Confirmation Dialog | 削除などの操作を確認するダイアログ |

### 3.4 テーマ

| 用語 (日本語) | 用語 (English) | 定義 |
|--------------|----------------|------|
| ライトモード | Light Mode | 明るい配色のテーマ |
| ダークモード | Dark Mode | 暗い配色のテーマ |
| テーマ切り替え | Theme Toggle | ライトモードとダークモードを切り替える |

---

## 4. アーキテクチャ (Architecture)

### 4.1 レイヤー

| 用語 (日本語) | 用語 (English) | 定義 |
|--------------|----------------|------|
| モデル | Model | ドメインオブジェクトのデータ構造を定義する層 |
| リポジトリ | Repository | データアクセスを抽象化し、Firestoreとの通信を担当する層 |
| ビューモデル | ViewModel | 画面のロジックと状態を管理する層 |
| ビュー | View | UIを表現する層 |

### 4.2 状態管理

| 用語 (日本語) | 用語 (English) | 定義 |
|--------------|----------------|------|
| プロバイダー | Provider | Riverpodで状態を提供するオブジェクト |
| ファミリープロバイダー | Family Provider | パラメータを受け取るプロバイダー |
| ストリーム | Stream | リアルタイムにデータ更新を受け取る非同期データフロー |
| 非同期値 | AsyncValue | loading/data/errorの3状態を持つ非同期データの値 |

### 4.3 データ操作

| 用語 (日本語) | 用語 (English) | 定義 |
|--------------|----------------|------|
| バッチ書き込み | Batch Write | 複数のFirestore操作をアトミックに実行する |
| カスケード削除 | Cascading Delete | 親データ削除時に関連する子データも一緒に削除する |
| リアルタイム同期 | Real-time Sync | Firestoreストリームによるデータの即時反映 |

---

## 5. データ構造 (Data Structure)

### 5.1 Firestore コレクション

```
users/                          # ユーザーコレクション
  └── {userId}/                 # ユーザードキュメント
        └── cardSets/           # カードセットサブコレクション
              └── {cardSetId}/  # カードセットドキュメント
                    └── cards/  # カードサブコレクション
                          └── {cardId}  # カードドキュメント
```

### 5.2 CardSetModel フィールド

| フィールド名 | 型 | 説明 |
|------------|-----|------|
| id | String | 一意識別子 |
| title | String | タイトル |
| description | String | 説明 |
| userId | String | 所有ユーザーID |
| cardCount | int | カード枚数 |
| createdAt | DateTime | 作成日時 |
| updatedAt | DateTime | 更新日時 |

### 5.3 CardModel フィールド

| フィールド名 | 型 | 説明 |
|------------|-----|------|
| id | String | 一意識別子 |
| cardSetId | String | 所属カードセットID |
| front | String | 表面（日本語） |
| back | String | 裏面（英語） |
| order | int | 並び順 |
| createdAt | DateTime | 作成日時 |
| updatedAt | DateTime | 更新日時 |

---

## 6. ビジネスルール (Business Rules)

| ルール | 説明 |
|--------|------|
| カード枚数の自動更新 | カード追加/削除時に親カードセットのcardCountが自動更新される |
| 並び順の維持 | カードは常にorder値の昇順で表示される |
| 検索フィルタリング | 検索はクライアントサイド（ViewModel層）で実行される |
| カスケード削除 | カードセット削除時、配下のすべてのカードもバッチ削除される |
| 匿名ユーザー | 認証は匿名ログインを使用し、ユーザー登録は不要 |
| 必須項目バリデーション | カードセットのタイトル、カードの表面/裏面は空にできない |

---

## 7. 画面遷移 (Navigation Flow)

```
認証チェック (AuthWrapper)
    ↓
カードセット一覧 (CardSetListView)
    ├── 新規作成 → カードセットダイアログ
    ├── 編集 → カードセットダイアログ
    ├── 削除 → 確認ダイアログ
    └── タップ → カード一覧 (CardListView)
                    ├── カード追加 → カードダイアログ
                    ├── カード編集 → カードダイアログ
                    ├── カード削除 → 確認ダイアログ
                    ├── 並び替え → ドラッグ&ドロップ
                    └── カードセット編集 → カードセットダイアログ
```

---

## 8. 単位・表記 (Units & Notation)

| 表記 | 意味 | 使用例 |
|-----|------|--------|
| 枚 | カードの数量単位 | "3枚" |
| 作成・編集 | 操作種別の表示 | ダイアログタイトル |
| 表面（日本語） | カードの質問側ラベル | フォームラベル |
| 裏面（英語） | カードの解答側ラベル | フォームラベル |

---

## 更新履歴

| 日付 | 内容 |
|------|------|
| 2026-02-01 | 初版作成 |
